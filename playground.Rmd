---
title: "load_map.rmd"
author: "Magnus Bendix Borregaard"
date: "4/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(raster)
library(sf)
library(leaflet)

aarhus <- brick('data/32VNH_0_B08,B04,B03.tiff')

bbox(aarhus)
crs(aarhus)
plotRGB(aarhus)
```

## Loading Roads
```{r}

#From https://mapcruzin.com/free-denmark-arcgis-maps-shapefiles.htm
# TODO: Look for a better map - some roads are missing
roads_4326 <- st_read('data/denmark-roads-shape/roads.shp')

roads_3857 <- st_transform(roads, crs = crs(aarhus)) # transform roads crs to match raster

#compareCRS(roads_crs, crs(aarhus))

#plot(st_geometry(roads_crs), col = "grey", border = "white")

aarhus_box <- st_make_grid(aarhus, n = 1) # Create a polygon 

#plot(aarhus_box)
#plot(st_geometry(roads_crs), add = TRUE)

cropped <- st_intersection(aarhus_box, roads_3857)
plot(st_geometry(roads_3857))
plot(st_geometry(cropped))
plot(cropped)
#View(st_geometry(roads))
#plotRGB(aarhus)
#plot(cropped, add = TRUE)

leaflet() %>%
  addProviderTiles("OpenStreetMap") %>%
  #addRasterImage(aarhus) %>% # Does not work with a brick, but should work with the raster heatmap
  addPolylines(data = st_transform(cropped, crs = 4326)) %>%
  setView(lng = 10.2, lat = 56.15, zoom = 11) # Aarhus
  

```